generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  PUBLISHER
  ADMIN
}

enum AdvertiserStatus {
  ACTIVE
  INACTIVE
  PENDING
}

enum TrackingLinkStatus {
  ACTIVE
  INACTIVE
  PAUSED
}

enum CommissionStatus {
  PENDING
  APPROVED
  DECLINED
  PAID
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  firstName     String?
  lastName      String?
  role          UserRole  @default(PUBLISHER)
  companyName   String?
  phone         String?
  logo          String?
  profilePicture String?
  
  // Publisher specific
  publisherProfile PublisherProfile?
  
  // Relations
  trackingLinks TrackingLink[]
  commissions   Commission[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model PublisherProfile {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Profile completion
  logoSubmitted      Boolean  @default(false)
  profilePictureSubmitted Boolean @default(false)
  basicDetailsCompleted Boolean @default(false)
  companyDetailsCompleted Boolean @default(false)
  billingDetailsCompleted Boolean @default(false)
  paymentDetailsCompleted Boolean @default(false)
  
  // Additional details
  website           String?
  description       String?
  taxId             String?
  address           String?
  city              String?
  country           String?
  postalCode        String?
  paymentMethod     String?
  paymentEmail      String?
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Advertiser {
  id                  String   @id @default(uuid())
  name                String
  logo                String?
  website             String
  baseUrl             String
  description         String?  @db.Text
  about               String?   @db.Text
  
  // Commission details
  commissionRate      String
  commissionType      String   // percentage, fixed, cpa, etc.
  region              String
  averagePaymentCycle Int?     // days
  
  // Status
  status              AdvertiserStatus @default(ACTIVE)
  
  // Categories
  categories          String[]
  advertiserType      String?
  
  // Promotional methods
  allowedMethods      String[]
  restrictedMethods   String[]
  
  // Relations
  trackingLinks       TrackingLink[]
  commissions         Commission[]
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
}

model TrackingLink {
  id              String            @id @default(uuid())
  publisherId     String
  advertiserId   String
  publisher      User              @relation(fields: [publisherId], references: [id], onDelete: Cascade)
  advertiser     Advertiser        @relation(fields: [advertiserId], references: [id], onDelete: Cascade)
  
  trackingCode   String            @unique
  trackingLink   String
  isDeepLink     Boolean           @default(false)
  landingPage    String?
  
  status         TrackingLinkStatus @default(ACTIVE)
  
  // Stats
  clickCount     Int               @default(0)
  conversionCount Int              @default(0)
  totalRevenue   Decimal           @default(0) @db.Decimal(10, 2)
  
  // Relations
  clicks         LinkClick[]
  commissions    Commission[]
  
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  
  @@unique([publisherId, advertiserId, trackingCode])
  @@index([trackingCode])
  @@index([publisherId, advertiserId])
}

model LinkClick {
  id              String        @id @default(uuid())
  trackingLinkId  String
  trackingLink    TrackingLink @relation(fields: [trackingLinkId], references: [id], onDelete: Cascade)
  
  ipAddress       String?
  userAgent       String?
  referrer        String?
  
  converted       Boolean       @default(false)
  conversionValue Decimal?      @db.Decimal(10, 2)
  
  clickedAt       DateTime      @default(now())
  convertedAt     DateTime?
  
  @@index([trackingLinkId])
  @@index([clickedAt])
}

model Commission {
  id              String            @id @default(uuid())
  publisherId     String
  advertiserId   String
  trackingLinkId String?
  
  publisher       User              @relation(fields: [publisherId], references: [id], onDelete: Cascade)
  advertiser      Advertiser        @relation(fields: [advertiserId], references: [id], onDelete: Cascade)
  trackingLink    TrackingLink?     @relation(fields: [trackingLinkId], references: [id], onDelete: SetNull)
  
  amount          Decimal           @db.Decimal(10, 2)
  status          CommissionStatus  @default(PENDING)
  
  transactionId   String?
  orderId         String?
  
  createdAt       DateTime          @default(now())
  approvedAt      DateTime?
  paidAt          DateTime?
  
  @@index([publisherId])
  @@index([status])
  @@index([createdAt])
}



